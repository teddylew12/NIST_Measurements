<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IV_curve &#8212; SFQ Chip Testing Automation 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SFQ Chip Testing Automation 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for IV_curve</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri May 26 14:26:21 2017</span>
<span class="sd">Purpose of this code is to sweep the current and plot an IV curve</span>
<span class="sd">@author: JPulecio</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#=================================</span>
<span class="c1">#Import libraries</span>
<span class="c1">#=================================</span>
<span class="kn">import</span> <span class="nn">Visa_Functions</span> <span class="k">as</span> <span class="nn">vf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pyqtgraph.Qt</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="c1">#from pyqtgraph.ptime import time</span>
<span class="kn">import</span> <span class="nn">IV_curve</span> <span class="k">as</span> <span class="nn">iv</span>
<span class="c1"># import master_Rn3 as rn</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1">#from pygame import mixer</span>


<span class="c1">#app = QtGui.QApplication([])</span>

<span class="c1">#=================================</span>
<span class="c1">#Global variables</span>
<span class="c1">#=================================</span>
<span class="c1">#address_I = 12</span>
<span class="n">address_I_yoko_GS200</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">address_I_yoko_GS610</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">address_V</span> <span class="o">=</span> <span class="mi">23</span>
<span class="n">address_Switch</span> <span class="o">=</span> <span class="mi">26</span>
<span class="c1">#short = &#39;@1!10&#39; # @cardnum!channel for the shorted line in the switch matrix</span>
<span class="n">short</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">shorts</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span> <span class="c1"># index corresponds to the card #, value is the short on that card</span>
<span class="n">nplc</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Vrange</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
<span class="n">VDwellTime</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">Irange</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
<span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;Z:\JPulecio\Code\Python\Resistance_Measurements\data</span><span class="se">\\</span><span class="s1">&#39;</span>
<span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#global variables</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Voltage over time&quot;</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;sample&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;V&quot;</span>


<span class="c1">#=================================</span>
<span class="c1">#Function definitions</span>
<span class="c1">#=================================  </span>

<div class="viewcode-block" id="sweep_current_live"><a class="viewcode-back" href="../code.html#IV_curve.sweep_current_live">[docs]</a><span class="k">def</span> <span class="nf">sweep_current_live</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">current_point</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
<span class="c1">#def sweep_current_live(app, curve, number_of_sweeps, I_min, I_max, step, card, channel1, channel2):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are app, curve (both pyqtgraph constructs), number of sweeps, </span>
<span class="sd">        current sweep start, current sweep stop, increment, card, chan1, chan2</span>
<span class="sd">    </span>
<span class="sd">    Updates a live plot with current on x axis, voltage on y axis</span>
<span class="sd">    </span>
<span class="sd">    Returns an array with current steps, measured voltages, and calculated</span>
<span class="sd">        resistance at every step</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># current initialization variables</span>
    <span class="c1"># lower range has less noise</span>
    <span class="n">Irange</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
    <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">2.</span>
    
    <span class="c1"># get GPIB instruments</span>
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>

    <span class="c1"># Initialize the switch matrix</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch_all</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>

    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">)</span> <span class="c1"># instead of card, used to be 1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span> <span class="c1"># instead of card, used to be 1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>    
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># open the short. shorts array corresponds to the short on each card</span>
<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.open_channel(Switch, 1, shorts[0])</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.open_channel(Switch, card, shorts[card-1]) </span>
<span class="c1">#    </span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>    
    
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># current point array</span>
    <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># voltmeter reads non zero when the current is zero</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Offset: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">offset</span><span class="p">)</span>
    
    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1">#Sweep Current up</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
                
                <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
                <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
                <span class="c1"># For fixing the offset</span>
                <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
                
                <span class="c1"># put current point in an array to plot in a different color</span>
                <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
                <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                
                <span class="c1"># live plotting</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
                <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                
                <span class="c1"># empty the current point array</span>
                <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="c1"># input from GUI</span>
                <span class="k">if</span> <span class="n">go</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            
            <span class="c1"># handle keyboard event    </span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

        <span class="c1">#Sweep Current down</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepDown Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_max</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
                <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
                <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
                <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
                
                <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
                <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    
                <span class="c1"># live plotting </span>
                <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
                <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                
                <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="k">if</span> <span class="n">go</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        
        <span class="c1"># clear out the different colored current point</span>
        <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">([],[])</span>

    <span class="c1"># turn it off and be ready to switch channels</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># card 2 shares with card 1</span>
<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.close_channel(Switch, 1, shorts[0])</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.close_channel(Switch, card, shorts[card-1])</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">close_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># open channels that were just measured</span>
    <span class="k">if</span> <span class="n">channel1</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>

<div class="viewcode-block" id="sweep_current_live_variable_points"><a class="viewcode-back" href="../code.html#IV_curve.sweep_current_live_variable_points">[docs]</a><span class="k">def</span> <span class="nf">sweep_current_live_variable_points</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">current_point</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">,</span> <span class="n">optionalic</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="c1">#def sweep_current_live_variable_points(app, curve, number_of_sweeps, I_min, I_max, step, card, channel1, channel2, optionalic=0):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are app, curve (both pyqtgraph constructs), number of sweeps, </span>
<span class="sd">        current sweep start, current sweep stop, increment, card, chan1, chan2</span>
<span class="sd">    </span>
<span class="sd">    Updates a live plot with current on x axis, voltage on y axis</span>
<span class="sd">    This plot will be very dense in points around the estimated ic</span>
<span class="sd">    </span>
<span class="sd">    Returns an array with current steps, measured voltages, and calculated</span>
<span class="sd">        resistance at every step</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># current initialization variables</span>
    <span class="c1"># lower range has less noise</span>
    <span class="n">Irange</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
    <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">2.</span>
    
    <span class="c1"># get GPIB instruments</span>
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch_all</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>

    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span> <span class="c1"># instead of card, used to be 1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span> <span class="c1"># instead of card, used to be 1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>    
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        
<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.open_channel(Switch, 1, shorts[0]) #card 2&#39;s short is on card 1</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.open_channel(Switch, card, shorts[card-1])</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># array to hold current point</span>
    <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
    

    <span class="c1"># offset</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
    
    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">optionalic</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">estimated_Ic</span> <span class="o">=</span> <span class="n">optionalic</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># ** location for hard-coded estimated Ic ** </span>

        <span class="n">estimated_Ic</span> <span class="o">=</span> <span class="mi">200</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span>

    <span class="c1"># set up the ranges</span>
    <span class="n">range1</span> <span class="o">=</span> <span class="n">estimated_Ic</span> <span class="o">*</span> <span class="mf">0.8</span>
    <span class="n">range2</span> <span class="o">=</span> <span class="n">estimated_Ic</span> <span class="o">*</span> <span class="mf">1.2</span>
    <span class="n">range3</span> <span class="o">=</span> <span class="n">estimated_Ic</span> <span class="o">*</span> <span class="mf">3.7</span>
    
    <span class="c1"># different density of points</span>
    <span class="n">step_less_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">range1</span><span class="p">)</span><span class="o">/</span><span class="mi">50</span>
    <span class="n">step_alot_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">range2</span><span class="o">-</span><span class="n">range1</span><span class="p">)</span><span class="o">/</span><span class="mi">400</span>
    
    <span class="c1"># start with lower density points</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range1</span><span class="p">,</span> <span class="n">step_less_points</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="c1"># for fixing the offset</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="c1"># current point</span>
            <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># live plotting</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span> <span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>    
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
    
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

    <span class="c1"># step with alot of points</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">range1</span><span class="p">,</span> <span class="n">range2</span><span class="p">,</span> <span class="n">step_alot_points</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
    
            <span class="c1"># for fixing the offset</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="c1"># current point</span>
            <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># live plotting</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
            
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

    <span class="c1"># Less points for rest of sweep</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">range2</span><span class="p">,</span> <span class="n">range3</span><span class="p">,</span> <span class="n">step_less_points</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

            <span class="c1"># for fixing the offset:</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># live plotting</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
    
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>


    <span class="c1">#Sweep Current down less points</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">range3</span><span class="o">-</span><span class="n">step_less_points</span><span class="p">,</span> <span class="n">range2</span><span class="p">,</span> <span class="o">-</span><span class="n">step_less_points</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># live plotting</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

    <span class="c1"># Sweep down with alot of points around the estimated Ic</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">range2</span><span class="o">-</span><span class="n">step_alot_points</span><span class="p">,</span> <span class="n">range1</span><span class="p">,</span> <span class="o">-</span><span class="n">step_alot_points</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># live plotting</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
    

    <span class="c1"># final sweep with less points</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">range1</span><span class="o">-</span><span class="n">step_less_points</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">step_less_points</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="n">current_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">current_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># live plotting</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">current_point</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">current_x</span><span class="p">,</span> <span class="n">current_y</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="n">current_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_y</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
    
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

    <span class="c1"># turn it all off, ready for next</span>
    <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>


<div class="viewcode-block" id="exitfunc"><a class="viewcode-back" href="../code.html#IV_curve.exitfunc">[docs]</a><span class="k">def</span> <span class="nf">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :param Switch: GPIB switch matrix object </span>
<span class="sd">    :param CurrentSource: GPIB current source object </span>
<span class="sd">    :param card: card #</span>
<span class="sd">    :param channel1: channel1</span>
<span class="sd">    :param channel2: channel2</span>
<span class="sd">    :return: None, but exits sweep cleanly</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.close_channel(Switch, 1, shorts[0]) # card 2&#39;s short is on card 1</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.close_channel(Switch, card, shorts[card-1])</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">close_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span></div>
    
    
<span class="k">def</span> <span class="nf">calc_steps</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">I_max</span><span class="o">-</span><span class="n">I_min</span><span class="p">)</span><span class="o">/</span><span class="n">step</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">step</span>

<div class="viewcode-block" id="manual_measure"><a class="viewcode-back" href="../code.html#IV_curve.manual_measure">[docs]</a><span class="k">def</span> <span class="nf">manual_measure</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Doesn&#39;t go through the switch matrix. Meant for plugging wires directly </span>
<span class="sd">    into the probe</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Irange</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
    <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">2.</span>
    
    <span class="c1"># get GPIB instruments</span>
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>
  
    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>    
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>


    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># starting 7/24: voltmeter reads non zero when the current is zero</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Offset: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">offset</span><span class="p">)</span>

    <span class="c1">#Sweep Current up</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sweep Begin:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        
        <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
        <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<span class="c1">#            V_values.append(V)</span>
        <span class="c1"># new, for fixing the offset 7/24:</span>
        <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="c1"># live plotting</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>


    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>
    



<div class="viewcode-block" id="sweep_current_live_GUI"><a class="viewcode-back" href="../code.html#IV_curve.sweep_current_live_GUI">[docs]</a><span class="k">def</span> <span class="nf">sweep_current_live_GUI</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curves</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are app, curve (both pyqtgraph constructs), number of sweeps, </span>
<span class="sd">        current sweep start, current sweep stop, increment, card, chan1, chan2</span>
<span class="sd">    </span>
<span class="sd">    Updates a live plot with current on x axis, voltage on y axis</span>
<span class="sd">    </span>
<span class="sd">    Returns an array with current steps, measured voltages, and calculated</span>
<span class="sd">        resistance at every step</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># current initialization variables</span>
    <span class="c1"># lower range has less noise</span>
    <span class="n">Irange</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
    <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">10.</span>
    
    <span class="c1"># get GPIB instruments</span>
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>

    <span class="c1"># different init. for squids vs. pcm</span>
<span class="c1">#    if card == 1 or card == 2:</span>
<span class="c1">#        vf.intialize_switch_multiple_cards(Switch, card)</span>
<span class="c1">#    else:</span>
<span class="c1">#    vf.intialize_switch(Switch)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch_all</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    
    

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>

    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span> <span class="c1"># instead of card, used to be 1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span> <span class="c1"># instead of card, used to be 1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>    
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1">#    if card == 10: # SQUID</span>
<span class="c1">#        vf.open_channel(Switch,10, short) #open short</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.open_channel(Switch,1, short) #open short</span>
        
<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.open_channel(Switch, 1, shorts[0])</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.open_channel(Switch, card, shorts[card-1])</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>

    <span class="c1"># starting 7/24: voltmeter reads non zero when the current is zero</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Offset: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">offset</span><span class="p">)</span>
    
    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1">#Sweep Current up</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>   
        <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">curves</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">([],[])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<span class="c1">#            V_values.append(V)</span>
            <span class="c1"># new, for fixing the offset 7/24:</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
            <span class="c1"># live plotting</span>
            <span class="n">curves</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span><span class="n">symbolBrush</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="c1">#Sweep Current down</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepDown Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_max</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">):</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                
            <span class="c1"># live plotting </span>
            <span class="n">curves</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">symbolBrush</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>


    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.close_channel(Switch, 1, shorts[0])</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.close_channel(Switch, card, shorts[card-1])</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">close_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">channel1</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>


    <span class="c1">#R = float(V)/float(I) #current is in milli Amps</span>
    <span class="c1">#print &#39;Voltage: %e V&#39; %float(V)</span>
    <span class="c1">#print &#39;Applied I: %e A&#39; %float(I)</span>
    <span class="c1">#print &#39;Resistance: %e Ohms&#39; %float(R)</span>
    
<span class="c1">#    #Play a sound when plot is done</span>
<span class="c1">#    mixer.init()</span>
<span class="c1">#    mixer.music.load(&quot;Whoomp-There-It-Is.mp3&quot;)</span>
<span class="c1">#    mixer.music.set_volume(0.4)</span>
<span class="c1">#    time.sleep(0.25)</span>
<span class="c1">#    mixer.music.play(1)</span>


    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>

<div class="viewcode-block" id="sweep_current_live_from_zero"><a class="viewcode-back" href="../code.html#IV_curve.sweep_current_live_from_zero">[docs]</a><span class="k">def</span> <span class="nf">sweep_current_live_from_zero</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are min and max current for sweep and steps</span>
<span class="sd">    Returns an array with current steps and measured voltages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Irange</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
    <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">2.</span>
    
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    <span class="c1">#vf.intialize_current(CurrentSource, Irange, compliance_voltage)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
	
    <span class="c1">#vf.current_filter(CurrentSource, 0) # turns on filter</span>
    <span class="c1">#vf.current_display(CurrentSource, 0)# turns display off</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>


    <span class="c1">#Turn on low to earth</span>
    <span class="c1">#vf.turnoff_current(CurrentSource) #have to turn off current source to turn on low to earth</span>
    <span class="c1">#sleep.time(0.1)</span>
    <span class="c1">#CurrentSource.write(&#39;outp:lte on&#39;) #turns on low to earth</span>
    <span class="c1">#sleep.time(0.1)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#vf.turnon_current(CurrentSource)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#    vf.open_channel(Switch,card, short) #open short</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="c1">#setup range</span>
    <span class="c1">#np.arange(I_min, I_max, step)</span>
    <span class="c1">#print(&quot;Entering current sweep&quot;)</span>

    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1">#Sweep Current up</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="c1">#vf.set_current_fast(CurrentSource, I)</span>

            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="c1">#Sweep Current down</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepDown Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_max</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">):</span>
            <span class="c1">#vf.set_current_fast(CurrentSource, I)</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepBackUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="c1">#vf.set_current_fast(CurrentSource, I)</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="c1">#print(&quot;Exited current sweep&quot;)</span>
    <span class="c1">#vf.set_current_fast(CurrentSource, 0)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#    vf.turnoff_current_yoko(CurrentSource)</span>
<span class="c1">#    </span>
<span class="c1">#    time.sleep(0.2)</span>

<span class="c1">#    vf.close_channel(Switch,card,short)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">close_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#print(&quot;opening channels before exit&quot;)</span>
    <span class="k">if</span> <span class="n">channel1</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="c1">#vf.turnoff_current()</span>

    <span class="c1">#R = float(V)/float(I) #current is in milli Amps</span>
    <span class="c1">#print &#39;Voltage: %e V&#39; %float(V)</span>
    <span class="c1">#print &#39;Applied I: %e A&#39; %float(I)</span>
    <span class="c1">#print &#39;Resistance: %e Ohms&#39; %float(R)</span>
    
<span class="c1">#    #Play a sound when plot is done</span>
<span class="c1">#    mixer.init()</span>
<span class="c1">#    mixer.music.load(&quot;Whoomp-There-It-Is.mp3&quot;)</span>
<span class="c1">#    mixer.music.set_volume(0.4)</span>
<span class="c1">#    time.sleep(0.25)</span>
<span class="c1">#    mixer.music.play(1)</span>

    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>
<span class="k">def</span> <span class="nf">stop</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">turn_current_off</span><span class="p">():</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="c1">#vf.turnoff_current(CurrentSource)</span>
<span class="c1">#    vf.turnoff_current_yoko(CurrentSource)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="sweep_current_live_Rn"><a class="viewcode-back" href="../code.html#IV_curve.sweep_current_live_Rn">[docs]</a><span class="k">def</span> <span class="nf">sweep_current_live_Rn</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are min and max current for sweep and steps</span>
<span class="sd">    Returns an array with current steps and measured voltages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># current initialization variabels </span>
    <span class="n">Irange</span> <span class="o">=</span> <span class="mi">200</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
    <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">5.</span>
    <span class="n">current_limit</span> <span class="o">=</span> <span class="mi">20</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span> <span class="c1"># This is highest possible current in A. Shouldn&#39;t get this high</span>
    
    <span class="c1"># get GPIB instruments</span>
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>
    
<span class="c1">#    vf.intialize_switch(Switch)</span>
<span class="c1">#    vf.intialize_switch_multiple_cards(Switch)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>


    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.open_channel(Switch, 1, shorts[0])</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.open_channel(Switch, card, shorts[card-1])</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>

    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1">#Sweep Current up</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">old_slope</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">current_limit</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
            <span class="c1"># after 20 points, begin calculated slope for each two points</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">I_values</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">:</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">V_values</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">I_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">I_values</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#                print(&quot;Slope: %d\n&quot; % slope)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="mi">1000</span>
            <span class="c1"># live plotting </span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="c1"># two checks to break the loop</span>
            
            <span class="c1"># if the slope jumps a significant amount, and voltage is </span>
            <span class="c1"># greater than the expected normal resistance voltage</span>
            <span class="k">if</span> <span class="n">slope</span> <span class="o">&gt;=</span> <span class="n">old_slope</span><span class="o">*</span><span class="mf">1.2</span> <span class="ow">and</span> <span class="n">V</span><span class="o">&gt;=</span><span class="n">V_max</span><span class="o">*</span><span class="mf">1.4</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">old_slope</span><span class="p">)</span>
                <span class="k">break</span>
            
            <span class="c1"># if the voltage reaches a certain threshold above the expected voltage</span>
            <span class="k">if</span> <span class="n">V</span><span class="o">&gt;=</span><span class="n">V_max</span><span class="o">+</span><span class="n">V_max</span><span class="o">*</span><span class="mf">1.5</span><span class="p">:</span> <span class="c1"># figure this out better</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;V_max_thresh reached&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            
            <span class="c1"># if both fail, the loop will stop at 50mA</span>
            
<span class="c1">#            if V&gt;3e-03:</span>
<span class="c1">#                break</span>
            
            <span class="n">old_slope</span> <span class="o">=</span> <span class="n">slope</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">go</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exitfunc</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">CurrentSource</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>


    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
<span class="c1">#    if card == 2:</span>
<span class="c1">#        vf.close_channel(Switch, 1, shorts[0])</span>
<span class="c1">#    else:</span>
<span class="c1">#        vf.close_channel(Switch, card, shorts[card-1])</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">close_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    
     <span class="c1">#Play a sound when plot is done</span>
<span class="c1">#    mixer.init()</span>
<span class="c1">#    mixer.music.load(&quot;Whoomp-There-It-Is.mp3&quot;)</span>
<span class="c1">#    mixer.music.set_volume(0.4)</span>
<span class="c1">#    time.sleep(0.25)</span>
<span class="c1">#    mixer.music.play(1)</span>
    
    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>

<div class="viewcode-block" id="sweep_current_live_warm_resistance"><a class="viewcode-back" href="../code.html#IV_curve.sweep_current_live_warm_resistance">[docs]</a><span class="k">def</span> <span class="nf">sweep_current_live_warm_resistance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="c1">#is this used at all?</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are min and max current for sweep and steps</span>
<span class="sd">    Returns an array with current steps and measured voltages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Irange</span> <span class="o">=</span> <span class="mi">10</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>    
    <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="mf">2.</span>
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#vf.turnon_current(CurrentSource)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#    vf.open_channel(Switch,card, short) #open short</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>




    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1">#Sweep Current up</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
            <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
            <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
            <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span><span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">symbolSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>



    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast_yoko</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#    vf.close_channel(Switch,card,short)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">close_short</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">shorts</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>


    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="c1">#vf.turnoff_current()</span>


    <span class="c1"># Play a sound when plot is done</span>
<span class="c1">#    mixer.init()</span>
<span class="c1">#    mixer.music.load(&quot;Whoomp-There-It-Is.mp3&quot;)</span>
<span class="c1">#    mixer.music.set_volume(0.4)</span>
<span class="c1">#    time.sleep(0.25)</span>
<span class="c1">#    mixer.music.play(1)</span>
    
    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>

<div class="viewcode-block" id="sweep_current2"><a class="viewcode-back" href="../code.html#IV_curve.sweep_current2">[docs]</a><span class="k">def</span> <span class="nf">sweep_current2</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are min and max current for sweep and steps</span>
<span class="sd">    Returns an array with current steps and measured voltages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span><span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">current_filter</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># turns on filter</span>
    <span class="c1">#vf.current_display(CurrentSource, 0)# turns display off</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    
    <span class="c1">#Turn on low to earth    </span>
    <span class="c1">#vf.turnoff_current(CurrentSource) #have to turn off current source to turn on low to earth</span>
    <span class="c1">#sleep.time(0.1)</span>
    <span class="c1">#CurrentSource.write(&#39;outp:lte on&#39;) #turns on low to earth</span>
    <span class="c1">#sleep.time(0.1)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span> <span class="n">short</span><span class="p">)</span> <span class="c1">#open short</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="n">I_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">V_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">R_values</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="c1">#setup range</span>
    <span class="c1">#np.arange(I_min, I_max, step)</span>
    <span class="c1">#print(&quot;Entering current sweep&quot;)</span>
    
    <span class="c1">#Sweep Current up</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">):</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
        <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>                
        <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        
    <span class="c1">#Sweep Current down</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepDown Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
        <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>                
        <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">I</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    
    <span class="c1">#print(&quot;Exited current sweep&quot;)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">short</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1">#print(&quot;opening channels before exit&quot;)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="c1">#vf.turnoff_current()</span>
    
    <span class="c1">#R = float(V)/float(I) #current is in milli Amps</span>
    <span class="c1">#print &#39;Voltage: %e V&#39; %float(V)</span>
    <span class="c1">#print &#39;Applied I: %e A&#39; %float(I)</span>
    <span class="c1">#print &#39;Resistance: %e Ohms&#39; %float(R) </span>
    
    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span></div>

<div class="viewcode-block" id="save_data"><a class="viewcode-back" href="../code.html#IV_curve.save_data">[docs]</a><span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves the raw data as ASCII seperated by tab</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">I_values</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="p">))</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I_values</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_values</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">R_values</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">name</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;row1: I, row2: V,row3: R </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>
   
<div class="viewcode-block" id="save_data_live"><a class="viewcode-back" href="../code.html#IV_curve.save_data_live">[docs]</a><span class="k">def</span> <span class="nf">save_data_live</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves the raw data as ASCII seperated by tab</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">I_values</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">column</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I_values</span>
    <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_values</span>
    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">R_values</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;col1: I, col2: V, col3: R </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="open_data"><a class="viewcode-back" href="../code.html#IV_curve.open_data">[docs]</a><span class="k">def</span> <span class="nf">open_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the values of I, V, R and plots data</span>
<span class="sd">    if newplot == 1 it will plot the file in new plot window otherwise it will plot it on same window</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span> <span class="c1">#opens new plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span></div>

<span class="k">def</span> <span class="nf">find_max_y_change_old</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="n">y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">max_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">sweep_up</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">sweep_down</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">step</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">critical_currents</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#holds the critical currents found in graph</span>
  
  <span class="c1">#find minumim in list</span>
  <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># min of a generator</span>
  <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># min of a generator</span>
  <span class="c1">#print(&quot;\n\nmin and max %f, %f&quot;%(min_x, max_x))</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">min_x</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">):</span>
      <span class="c1">#sweep_up = int((len(x)/2)-1)</span>
      <span class="c1">#sweep_down = int(len(x)-1)</span>
      <span class="c1">#print(&quot;Sweep_up from %f to %f&quot;%(int(min_x), int(max_x) ))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Postive half sweep&quot;</span><span class="p">)</span>
      <span class="n">sweep_flag</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#means only positive sweep</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Negative number found Full sweep&quot;</span><span class="p">)</span>
      <span class="n">sweep_flag</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#means only full IV sweep</span>

  <span class="n">position1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">n1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1">#print(x)</span>
  <span class="c1">#print(&quot;n1:%d&quot;%n1)</span>
  <span class="n">avg_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  
  <span class="c1">#find avg change in y</span>
  <span class="k">for</span> <span class="n">n0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
      <span class="n">y_change</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
      <span class="n">avg_y_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg_y_change</span> <span class="o">+</span> <span class="n">y_change</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="c1">#print(y_change, avg_y_change, n0)</span>
  <span class="c1">#print(&quot;avg_y_change: %f&quot;%avg_y_change)</span>

  <span class="c1">#print(int((sweep_up-sweep_up/2)))</span>
  <span class="c1">#Find I_c</span>
  <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sweep_up</span><span class="p">):</span> 
      <span class="c1">#c =+1 </span>
      <span class="n">y_change</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
      <span class="n">delta_max</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_change</span> <span class="o">-</span> <span class="n">max_y_change</span><span class="p">)</span>

<span class="c1">#      avg_y_change = (avg_y_change + y_change)/(c+1)</span>
      <span class="c1">#print(&quot;n1:%d y_change:%f, max_y_change:%f, delta_y_max:%f&quot;%(n1,y_change,max_y_change, delta_max))</span>

      <span class="c1">#print(y_change)</span>
    	
	  
	   <span class="c1">#Check to see if new y_change is I_c</span>
      <span class="k">if</span> <span class="n">y_change</span> <span class="o">&gt;</span> <span class="n">max_y_change</span><span class="p">:</span>
          <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_change</span> <span class="o">-</span> <span class="n">max_y_change</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_y_change</span><span class="p">:</span> <span class="c1">#is the change greater than the avg_change</span>
              <span class="n">max_y_change</span> <span class="o">=</span> <span class="n">y_change</span>
              <span class="n">position1</span> <span class="o">=</span> <span class="n">n1</span> <span class="c1">#position in array of max_y_change</span>
              <span class="c1">#print(&quot;new max change in sweep up&quot;)</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">n1</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sweep_up</span><span class="o">-</span><span class="n">sweep_up</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sweep_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="c1">#adds the first I_c if full sweep</span>
          <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position1</span><span class="p">)</span>
          <span class="n">max_y_change</span> <span class="o">=</span> <span class="mf">0.0</span>
          
  <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position1</span><span class="p">)</span> <span class="c1">#adds the last found I_c</span>
		
  <span class="c1">#print (&#39;max_y_change: %e&#39; %max_y_change)</span>
  <span class="c1">#print (&#39;avg_y_change: %e&#39; %avg_y_change)</span>

  <span class="c1">#Reset y_change</span>
  <span class="n">y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">max_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">n2</span> <span class="o">=</span> <span class="n">sweep_up</span> <span class="o">+</span><span class="mi">1</span> 
  <span class="n">position2</span><span class="o">=</span><span class="mi">0</span>
  <span class="c1">#c = 0</span>
  <span class="c1">#avg_y_change = 0</span>
  
  
  <span class="c1">#Find max change in y for the second half of data</span>
  <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sweep_up</span><span class="p">,</span> <span class="n">sweep_down</span><span class="p">):</span>
      <span class="c1">#c =+1 </span>
      <span class="n">y_change</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
      <span class="c1">#avg_y_change = (avg_y_change + y_change)/(c+1)</span>
      <span class="n">delta_max</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_change</span> <span class="o">-</span> <span class="n">max_y_change</span><span class="p">)</span>

      <span class="c1">#print(&quot;n2:%d y_change:%f, max_y_change:%f, delta_y_max:%f&quot;%(n2,y_change,max_y_change, delta_max))</span>
      
      <span class="c1">#check to see if new max_y_change</span>
      <span class="k">if</span> <span class="n">y_change</span> <span class="o">&gt;</span> <span class="n">max_y_change</span><span class="p">:</span>
          <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_change</span> <span class="o">-</span> <span class="n">max_y_change</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_y_change</span><span class="p">:</span> <span class="c1">#is the differnce in change greater than the previous change</span>
              <span class="n">max_y_change</span> <span class="o">=</span> <span class="n">y_change</span>
              <span class="n">position2</span> <span class="o">=</span> <span class="n">n2</span> <span class="c1">#position in array of max_y_change\</span>
              <span class="c1">#print(&quot;new max change in sweep down&quot;)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">n2</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sweep_up</span><span class="o">+</span><span class="n">sweep_up</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sweep_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="c1">#adds the first I_r</span>
          <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position2</span><span class="p">)</span> 
          <span class="n">max_y_change</span> <span class="o">=</span> <span class="mf">0.0</span>

          
  <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position2</span><span class="p">)</span> <span class="c1">#adds the last found I_c</span>
  <span class="c1">#print(critical_currents)</span>

  <span class="k">return</span> <span class="n">position1</span><span class="p">,</span> <span class="n">position2</span><span class="p">,</span> <span class="n">critical_currents</span>

<div class="viewcode-block" id="find_max_y_change"><a class="viewcode-back" href="../code.html#IV_curve.find_max_y_change">[docs]</a><span class="k">def</span> <span class="nf">find_max_y_change</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">num_JJ</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Uses an envelope around zero based on num_JJ, returns first point to enter </span>
<span class="sd">  the bounds and last point to exit</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="n">num_JJ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">bound</span> <span class="o">=</span> <span class="n">num_JJ</span> <span class="o">*</span> <span class="mf">0.25e-06</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="n">bound</span> <span class="o">=</span> <span class="n">num_JJ</span> <span class="o">*</span> <span class="mi">10</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>
  <span class="n">y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">max_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">sweep_up</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">sweep_down</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">step</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">critical_currents</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#holds the critical currents found in graph</span>
  
  <span class="c1">#find minumim in list</span>
  <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># min of a generator</span>
  <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># min of a generator</span>
  <span class="c1">#print(&quot;\n\nmin and max %f, %f&quot;%(min_x, max_x))</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">min_x</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">):</span>
      <span class="c1">#sweep_up = int((len(x)/2)-1)</span>
      <span class="c1">#sweep_down = int(len(x)-1)</span>
      <span class="c1">#print(&quot;Sweep_up from %f to %f&quot;%(int(min_x), int(max_x) ))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Postive half sweep&quot;</span><span class="p">)</span>
      <span class="n">sweep_flag</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#means only positive sweep</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Negative number found Full sweep&quot;</span><span class="p">)</span>
      <span class="n">sweep_flag</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#means only full IV sweep</span>

  <span class="n">position1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">n1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1">#print(x)</span>
  <span class="c1">#print(&quot;n1:%d&quot;%n1)</span>
  <span class="n">avg_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  
  <span class="c1">#find avg change in y</span>
  <span class="k">for</span> <span class="n">n0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
      <span class="n">y_change</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
      <span class="n">avg_y_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg_y_change</span> <span class="o">+</span> <span class="n">y_change</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">enter_index</span> <span class="o">=</span><span class="p">[]</span>
  <span class="n">leave_index</span> <span class="o">=</span> <span class="p">[]</span>
  
  <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sweep_up</span><span class="p">):</span> 
      
      <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span><span class="o">&gt;=-</span><span class="n">bound</span><span class="p">:</span>
          <span class="n">enter_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
              <span class="n">leave_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="c1">#  print(enter_index)</span>
<span class="c1">#  print(leave_index)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">leave_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># critical currents were found</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enter_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leave_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1"># critical currents were not found, append the middle point</span>
  <span class="c1"># should probably change this to not append anything, then error catch in measure_Ic</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
      
          
  <span class="n">n2</span> <span class="o">=</span> <span class="n">sweep_up</span> <span class="o">+</span><span class="mi">1</span> 

  <span class="n">enter_index</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">leave_index</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#  print(sweep_up)</span>
<span class="c1">#  print(sweep_down)</span>
  
  <span class="c1">#Find max change in y for the second half of data</span>
  <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sweep_up</span><span class="p">,</span> <span class="n">sweep_down</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">bound</span><span class="p">:</span>
          <span class="n">enter_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">bound</span><span class="p">:</span>
              <span class="n">leave_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
              
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">leave_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># critical currents were found</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enter_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leave_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1"># critical currents were not found, append the middle point</span>
  <span class="c1"># should probably change this to not append anything, then error catch in measure_Ic</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
<span class="c1">#  print(critical_currents)</span>
  
  <span class="k">return</span> <span class="n">critical_currents</span></div>

<div class="viewcode-block" id="find_max_y_change_half_sweep"><a class="viewcode-back" href="../code.html#IV_curve.find_max_y_change_half_sweep">[docs]</a><span class="k">def</span> <span class="nf">find_max_y_change_half_sweep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">num_JJ</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Uses an envelope around zero based on num_JJ, returns first point to enter </span>
<span class="sd">  the bounds and last point to exit</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="n">num_JJ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">bound</span> <span class="o">=</span> <span class="n">num_JJ</span> <span class="o">*</span> <span class="mf">0.25e-06</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="n">bound</span> <span class="o">=</span> <span class="n">num_JJ</span> <span class="o">*</span> <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>
  <span class="n">y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">max_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">sweep_up</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">sweep_down</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">step</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">critical_currents</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#holds the critical currents found in graph</span>
  
  

  <span class="n">position1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">n1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1">#print(x)</span>
  <span class="c1">#print(&quot;n1:%d&quot;%n1)</span>
  <span class="n">avg_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  
  <span class="c1">#find avg change in y</span>
  <span class="k">for</span> <span class="n">n0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
      <span class="n">y_change</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
      <span class="n">avg_y_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg_y_change</span> <span class="o">+</span> <span class="n">y_change</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">enter_index</span> <span class="o">=</span><span class="p">[]</span>
  <span class="n">leave_index</span> <span class="o">=</span> <span class="p">[]</span>
  
  <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sweep_up</span><span class="p">):</span> 
      
      <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span><span class="o">&gt;=-</span><span class="n">bound</span><span class="p">:</span>
          <span class="n">enter_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
              <span class="n">leave_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="c1">#  print(enter_index)</span>
<span class="c1">#  print(leave_index)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leave_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># critical currents were found</span>
<span class="c1">#      critical_currents.append(enter_index[0])</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leave_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1"># critical currents were not found, append the middle point</span>
  <span class="c1"># should probably change this to not append anything, then error catch in measure_Ic</span>
<span class="c1">#      critical_currents.append(abs(sweep_up - sweep_down))</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
      
          
  <span class="n">n2</span> <span class="o">=</span> <span class="n">sweep_up</span> <span class="o">+</span><span class="mi">1</span> 

  <span class="n">enter_index</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">leave_index</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#  print(sweep_up)</span>
<span class="c1">#  print(sweep_down)</span>
  
  <span class="c1">#Find max change in y for the second half of data</span>
  <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sweep_up</span><span class="p">,</span> <span class="n">sweep_down</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">bound</span><span class="p">:</span>
          <span class="n">enter_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">bound</span><span class="p">:</span>
              <span class="n">leave_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
              
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># critical currents were found</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enter_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1">#      critical_currents.append(leave_index[0])</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1"># critical currents were not found, append the middle point</span>
  <span class="c1"># should probably change this to not append anything, then error catch in measure_Ic</span>
<span class="c1">#      critical_currents.append(abs(sweep_up - sweep_down))</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
<span class="c1">#  print(critical_currents)</span>
  
  <span class="k">return</span> <span class="n">critical_currents</span></div>
<div class="viewcode-block" id="find_max_y_change_single_sweep"><a class="viewcode-back" href="../code.html#IV_curve.find_max_y_change_single_sweep">[docs]</a><span class="k">def</span> <span class="nf">find_max_y_change_single_sweep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">num_JJ</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Uses an envelope around zero based on num_JJ, returns first point to enter </span>
<span class="sd">  the bounds and last point to exit</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="n">num_JJ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">bound</span> <span class="o">=</span> <span class="n">num_JJ</span> <span class="o">*</span> <span class="o">.</span><span class="mi">25</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="n">bound</span> <span class="o">=</span> <span class="n">num_JJ</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>
  <span class="n">y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">max_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">sweep_up</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">sweep_down</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">step</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">critical_currents</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#holds the critical currents found in graph</span>


  <span class="n">position1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">n1</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1">#print(x)</span>
  <span class="c1">#print(&quot;n1:%d&quot;%n1)</span>
  <span class="n">avg_y_change</span> <span class="o">=</span> <span class="mi">0</span>
  
  <span class="c1">#find avg change in y</span>
  <span class="k">for</span> <span class="n">n0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
      <span class="n">y_change</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
      <span class="n">avg_y_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg_y_change</span> <span class="o">+</span> <span class="n">y_change</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">enter_index</span> <span class="o">=</span><span class="p">[]</span>
  <span class="n">leave_index</span> <span class="o">=</span> <span class="p">[]</span>
  
  <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span> 
      
      <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span><span class="o">&gt;=-</span><span class="n">bound</span><span class="p">:</span>
          <span class="n">enter_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
              <span class="n">leave_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    
<span class="c1">#  print(enter_index)</span>
<span class="c1">#  print(leave_index)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enter_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">leave_index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># critical currents were found</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enter_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leave_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1"># critical currents were not found, append the middle point</span>
  <span class="c1"># should probably change this to not append anything, then error catch in measure_Ic</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
      <span class="n">critical_currents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sweep_up</span> <span class="o">-</span> <span class="n">sweep_down</span><span class="p">))</span>
      
          
<span class="c1">#  n2 = sweep_up +1 </span>
<span class="c1">#</span>
<span class="c1">#  enter_index = []</span>
<span class="c1">#  leave_index = []</span>
<span class="c1">##  print(sweep_up)</span>
<span class="c1">##  print(sweep_down)</span>
<span class="c1">#  </span>
<span class="c1">#  #Find max change in y for the second half of data</span>
<span class="c1">#  for n2 in range(sweep_up, sweep_down):</span>
<span class="c1">#      if y[n2]&lt;=bound:</span>
<span class="c1">#          enter_index.append(n2)</span>
<span class="c1">#      if len(enter_index) != 0:</span>
<span class="c1">#          if y[n2] &lt;= -bound:</span>
<span class="c1">#              leave_index.append(n2-1)</span>
<span class="c1">#              </span>
<span class="c1">#  if len(enter_index)&gt;0 and len(leave_index)&gt;0: # critical currents were found</span>
<span class="c1">#      critical_currents.append(enter_index[0])</span>
<span class="c1">#      critical_currents.append(leave_index[0])</span>
<span class="c1">#  else: # critical currents were not found, append the middle point</span>
<span class="c1">#  # should probably change this to not append anything, then error catch in measure_Ic</span>
<span class="c1">#      critical_currents.append(abs(sweep_up - sweep_down))</span>
<span class="c1">#      critical_currents.append(abs(sweep_up - sweep_down))</span>
<span class="c1">##  print(critical_currents)</span>
  
  <span class="k">return</span> <span class="n">critical_currents</span></div>

<span class="k">def</span> <span class="nf">plot_IV</span><span class="p">(</span><span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="c1">#fig, ax = plt.subplots()</span>
            
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Channels &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel2</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
        <span class="n">Ic_pos</span><span class="p">,</span> <span class="n">Iret_pos</span><span class="p">,</span> <span class="n">critical_currents</span> <span class="o">=</span> <span class="n">find_max_y_change</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">)</span> <span class="c1">#finds Ic and Iret</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweep &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span> <span class="c1">#plots the line sweeps</span>
        
        <span class="c1">#plots the critical currents</span>
        <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">n1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">type_of_current</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
                <span class="n">htext_offset</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">*.</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">vtext_offset</span> <span class="o">=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">*.</span><span class="mi">3</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span> 
                <span class="n">type_of_current</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
                <span class="c1">#htext_offset = 1.15</span>
                <span class="n">vtext_offset</span> <span class="o">=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">*.</span><span class="mi">15</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]],</span><span class="n">V</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="c1">#plots Ic</span>
            <span class="c1">#plt.plot(I[Iret_pos],V[Iret_pos], &quot;ro&quot;) #plots Iret</span>
            <span class="n">I_c</span> <span class="o">=</span> <span class="n">type_of_current</span><span class="o">+</span><span class="s1">&#39;:(&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]])</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="c1">#I_r = &#39;Ir:(&#39; + &#39;{:.2E}&#39;.format(I[Iret_pos]) + &#39;,&#39;+ &#39;{:.2E}&#39;.format(V[Iret_pos]) + &#39;)&#39;</span>

            <span class="c1">#plt.annotate(I_c, xy=(2, 1), xytext=(3, 4), arrowprops=dict(facecolor=&#39;black&#39;, shrink=0.05))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">I_c</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]]</span><span class="o">+</span><span class="n">htext_offset</span><span class="p">,</span> <span class="n">V</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]]</span><span class="o">+</span><span class="n">vtext_offset</span><span class="p">))</span>
            <span class="c1">#plt.annotate(I_r, xy=(I[Iret_pos]*1.15, V[Iret_pos]))</span>

  <span class="c1">#print &quot;I_c = %f, I_r = %f&quot; %(position1, position2)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1">#print(I)</span>
        
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">card</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_Ch&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H.%M.%S&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>    
    <span class="n">save_data</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;data</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">plot_IV_yoko</span><span class="p">(</span><span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="c1">#fig, ax = plt.subplots()</span>
            
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Channels &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel2</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_yoko</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
        <span class="n">Ic_pos</span><span class="p">,</span> <span class="n">Iret_pos</span><span class="p">,</span> <span class="n">critical_currents</span> <span class="o">=</span> <span class="n">find_max_y_change_old</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">)</span> <span class="c1">#finds Ic and Iret</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweep &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span> <span class="c1">#plots the line sweeps</span>
        
        <span class="c1">#plots the critical currents</span>
        <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">n1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">type_of_current</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
                <span class="n">htext_offset</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">*.</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">vtext_offset</span> <span class="o">=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">*.</span><span class="mi">3</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span> 
                <span class="n">type_of_current</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
                <span class="c1">#htext_offset = 1.15</span>
                <span class="n">vtext_offset</span> <span class="o">=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_currents</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">*.</span><span class="mi">15</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]],</span><span class="n">V</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="c1">#plots Ic</span>
            <span class="c1">#plt.plot(I[Iret_pos],V[Iret_pos], &quot;ro&quot;) #plots Iret</span>
            <span class="n">I_c</span> <span class="o">=</span> <span class="n">type_of_current</span><span class="o">+</span><span class="s1">&#39;:(&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]])</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="c1">#I_r = &#39;Ir:(&#39; + &#39;{:.2E}&#39;.format(I[Iret_pos]) + &#39;,&#39;+ &#39;{:.2E}&#39;.format(V[Iret_pos]) + &#39;)&#39;</span>

            <span class="c1">#plt.annotate(I_c, xy=(2, 1), xytext=(3, 4), arrowprops=dict(facecolor=&#39;black&#39;, shrink=0.05))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">I_c</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]]</span><span class="o">+</span><span class="n">htext_offset</span><span class="p">,</span> <span class="n">V</span><span class="p">[</span><span class="n">critical_currents</span><span class="p">[</span><span class="n">n1</span><span class="p">]]</span><span class="o">+</span><span class="n">vtext_offset</span><span class="p">))</span>
            <span class="c1">#plt.annotate(I_r, xy=(I[Iret_pos]*1.15, V[Iret_pos]))</span>

  <span class="c1">#print &quot;I_c = %f, I_r = %f&quot; %(position1, position2)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1">#print(I)</span>
        
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">card</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_Ch&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">channel2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H.%M.%S&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>    
    <span class="n">save_data</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;data</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="plot_IV_live"><a class="viewcode-back" href="../code.html#IV_curve.plot_IV_live">[docs]</a><span class="k">def</span> <span class="nf">plot_IV_live</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calls sweep current live, returns I, V and R</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_live</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
<span class="c1">#    I, V, R = sweep_current_live_from_zero(app, curve, number_of_sweeps, I_min, I_max, step, card, channel1, channel2)</span>
    
    <span class="n">Ic_pos</span><span class="p">,</span> <span class="n">Iret_pos</span><span class="p">,</span> <span class="n">critical_currents</span> <span class="o">=</span> <span class="n">find_max_y_change_old</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">)</span> <span class="c1">#finds Ic and Iret</span>



   

    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span></div>

<div class="viewcode-block" id="plot_IV_live_variable_points"><a class="viewcode-back" href="../code.html#IV_curve.plot_IV_live_variable_points">[docs]</a><span class="k">def</span> <span class="nf">plot_IV_live_variable_points</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calls sweep current live variable points, returns I, V and R</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_live_variable_points</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
<span class="c1">#    I, V, R = sweep_current_live_from_zero(app, curve, number_of_sweeps, I_min, I_max, step, card, channel1, channel2)</span>

    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span></div>

<span class="k">def</span> <span class="nf">plot_IV_test</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curves</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">go</span>
    <span class="n">go</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">I_min</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">I_max</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">number_of_sweeps</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
            
        <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">curves</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">([],[])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
            <span class="n">curves</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">go</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

<span class="k">def</span> <span class="nf">plot_IV_live_Rn</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>


    <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_live_Rn</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span>

<span class="k">def</span> <span class="nf">plot_warm_resistance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    
    <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_live_warm_resistance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span>

<span class="k">def</span> <span class="nf">automate_channel_IV</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">currents</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
    <span class="n">I_min</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">I_max</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">channel_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">channel_pairs</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">channel1</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">channel2</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">plot_IV</span><span class="p">(</span><span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">automate_channel_IV_yoko</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">currents</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
    <span class="n">I_min</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">I_max</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">channel_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">channel_pairs</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">channel1</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">channel2</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">plot_IV_yoko</span><span class="p">(</span><span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">automate_channel_IV_live</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">current_point</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">currents</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">optionalic</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="c1">#def automate_channel_IV_live(app, curve, card, channels, currents, step, number_of_sweeps, optionalic=0):</span>
    <span class="n">I_min</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">I_max</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">channel_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">channel_pairs</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">channel1</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">channel2</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">optionalic</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_live</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">current_point</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
<span class="c1">#            I,V,R = sweep_current_live(app, curve, number_of_sweeps, I_min, I_max, step, card, channel1, channel2)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_live_variable_points</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">current_point</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">,</span> <span class="n">optionalic</span><span class="o">=</span><span class="n">optionalic</span><span class="p">)</span>
<span class="c1">#            I,V,R = sweep_current_live_variable_points(app, curve, number_of_sweeps, I_min, I_max, step, card, channel1, channel2, optionalic=optionalic)</span>
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span>

<span class="c1"># not needed anymore</span>
<span class="k">def</span> <span class="nf">automate_channel_IV_live_variable_points</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">currents</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">):</span>
    <span class="n">I_min</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">I_max</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">channel_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">channel_pairs</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">channel1</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">channel2</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span> <span class="o">=</span> <span class="n">sweep_current_live_variable_points</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">number_of_sweeps</span><span class="p">,</span> <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">R</span>

<div class="viewcode-block" id="find_Ic"><a class="viewcode-back" href="../code.html#IV_curve.find_Ic">[docs]</a><span class="k">def</span> <span class="nf">find_Ic</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span></div>
 
<div class="viewcode-block" id="create_plot_window"><a class="viewcode-back" href="../code.html#IV_curve.create_plot_window">[docs]</a><span class="k">def</span> <span class="nf">create_plot_window</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of a pyqtwindow</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c1">#p.setRange(QtCore.QRectF(0, -10, 5000, 20)) </span>
    <span class="c1">#p.setLabel(xlabel, ylabel)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">curve</span></div>
    
<div class="viewcode-block" id="live_plot"><a class="viewcode-back" href="../code.html#IV_curve.live_plot">[docs]</a><span class="k">def</span> <span class="nf">live_plot</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">channel1</span><span class="p">,</span> <span class="n">channel2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inputs are min and max current for sweep and steps</span>
<span class="sd">    Returns an array with current steps and measured voltages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">([])</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">create_plot_window</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
    
    <span class="n">Voltmeter</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">()</span>
    <span class="n">CurrentSource</span><span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_switch</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_current</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">Irange</span><span class="p">,</span> <span class="n">compliance_voltage</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">current_filter</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># turns on filter</span>
    <span class="c1">#vf.current_display(CurrentSource, 0)# turns display off</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    
    <span class="c1">#Turn on low to earth    </span>
    <span class="c1">#vf.turnoff_current(CurrentSource) #have to turn off current source to turn on low to earth</span>
    <span class="c1">#sleep.time(0.1)</span>
    <span class="c1">#CurrentSource.write(&#39;outp:lte on&#39;) #turns on low to earth</span>
    <span class="c1">#sleep.time(0.1)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">intialize_voltage</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">nplc</span><span class="p">,</span> <span class="n">Vrange</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">vf</span><span class="o">.</span><span class="n">turnon_current</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span> <span class="n">short</span><span class="p">)</span> <span class="c1">#open short</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1">#Going to use lists to start with for flexibility, even though slower than arrays</span>
    <span class="k">global</span> <span class="n">I_values</span> 
    <span class="k">global</span> <span class="n">V_values</span> 
    <span class="k">global</span> <span class="n">R_values</span> 


    <span class="c1">#setup range</span>
    <span class="c1">#np.arange(I_min, I_max, step)</span>
    <span class="c1">#print(&quot;Entering current sweep&quot;)</span>
    
    <span class="c1">#Sweep Current up</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepUp Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
        <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>                
        <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
        <span class="c1">#print(&#39;%e &#39;%I,end=&quot; &quot;)</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="c1">#print(x, data)</span>
        <span class="c1">#t.sleep(1)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>  <span class="c1">## force complete redraw for every plot</span>
        
    <span class="c1">#Sweep Current down</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Channel </span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> SweepDown Current:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">I_max</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">I_min</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="o">-</span><span class="n">step</span><span class="p">):</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">read_voltage_fast</span><span class="p">(</span><span class="n">Voltmeter</span><span class="p">,</span> <span class="n">VDwellTime</span><span class="p">)</span>
        <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>                
        <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        <span class="n">R_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
        <span class="c1">#print(&#39;%e&#39;%I,end=&quot; &quot;)</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="c1">#print(x, data)</span>
        <span class="c1">#t.sleep(1)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>  <span class="c1">## force complete redraw for every plot</span>
                     
    
    <span class="c1">#print(&quot;Exited current sweep&quot;)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">set_current_fast</span><span class="p">(</span><span class="n">CurrentSource</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>

    
    <span class="n">vf</span><span class="o">.</span><span class="n">close_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">short</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1">#print(&quot;opening channels before exit&quot;)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel1</span><span class="p">)</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span><span class="n">card</span><span class="p">,</span><span class="n">channel2</span><span class="p">)</span>
    <span class="c1">#vf.turnoff_current()</span>
    
    <span class="c1">#R = float(V)/float(I) #current is in milli Amps</span>
    <span class="c1">#print &#39;Voltage: %e V&#39; %float(V)</span>
    <span class="c1">#print &#39;Applied I: %e A&#39; %float(I)</span>
    <span class="c1">#print &#39;Resistance: %e Ohms&#39; %float(R) </span>
    
    <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">,</span> <span class="n">R_values</span>  </div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SFQ Chip Testing Automation 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Soroush Khadem, Javier Pulecio.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>